# name: CI/CD Pipeline

# on:
#   push:
#     branches: [ main, develop ]
#   pull_request:
#     branches: [ main ]

# jobs:
#   test:
#     runs-on: ubuntu-latest

#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4

#     - name: Setup PHP
#       uses: shivammathur/setup-php@v2
#       with:
#         php-version: '8.2'
#         extensions: mbstring, intl, bcmath
#         coverage: none

#     - name: Setup Node.js
#       uses: actions/setup-node@v3
#       with:
#         node-version: '20'
#         cache: 'pnpm'

#     - name: Install Composer dependencies
#       run: composer install --prefer-dist --no-progress

#     - name: Install pnpm dependencies
#       run: pnpm install

#     - name: Run PHPStan
#       run: composer run phpstan

#     - name: Run PHPCS
#       run: composer run phpcs

#     - name: Build assets
#       run: pnpm run build

#   deploy:
#     needs: test
#     runs-on: ubuntu-latest
#     if: github.ref == 'refs/heads/main'

#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4

#     - name: Setup Node.js
#       uses: actions/setup-node@v3
#       with:
#         node-version: '20'
#         cache: 'pnpm'

#     - name: Install pnpm dependencies
#       run: pnpm install

#     - name: Build assets for production
#       run: pnpm run build

#     - name: Deploy to server
#       env:
#         DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
#         SERVER_IP: ${{ secrets.SERVER_IP }}
#         SERVER_USER: ${{ secrets.SERVER_USER }}
#         DEPLOY_PATH: ${{ secrets.DEPLOY_PATH }}
#       run: |
#         echo "$DEPLOY_KEY" > deploy_key
#         chmod 600 deploy_key
#         rsync -avz -e "ssh -i deploy_key -o StrictHostKeyChecking=no" --delete ./ $SERVER_USER@$SERVER_IP:$DEPLOY_PATH --exclude='.git' --exclude='node_modules'
